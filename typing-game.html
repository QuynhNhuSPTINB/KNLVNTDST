<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üéØ G√µ 10 ng√≥n ‚Äî Phi√™n b·∫£n Ti·ªÉu h·ªçc</title>
<style>
:root {
  --bg: #ffe4d1;
  --accent: #ff7a59;
  --key: #fff6f0;
  --border: #ffbfa3;
}
body {
  font-family: "Serif", sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 0;
  text-align: center;
}
h1 {
  color: var(--accent);
  margin-top: 15px;
}
#container {
  max-width: 800px;
  margin: auto;
  padding: 10px;
}
#nameInput, #lessonSelect, #modeSelect, #startBtn {
  font-size: 18px;
  padding: 8px 12px;
  margin: 6px;
  border-radius: 10px;
  border: 2px solid var(--accent);
}
#startBtn {
  background: var(--accent);
  color: white;
  cursor: pointer;
}
#gameArea {
  margin-top: 15px;
  display: none;
}
#targetText {
  font-size: 24px;
  margin-bottom: 10px;
  color: #333;
}
#typedText {
  font-size: 24px;
  color: gray;
}
#result {
  font-size: 20px;
  color: green;
  margin-top: 8px;
}
#timer {
  font-size: 22px;
  font-weight: bold;
  color: #ff5733;
  margin-bottom: 10px;
}
#keyboard {
  margin: 25px auto;
  display: inline-block;
  text-align: center;
  user-select: none;
}
.kb-row {
  display: flex;
  justify-content: center;
}
.key {
  display: inline-block;
  background: var(--key);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px;
  min-width: 36px;
  margin: 3px;
  font-weight: bold;
  box-shadow: 0 2px 3px rgba(0,0,0,0.1);
  transition: background 0.1s;
}
.key.active {
  background: #ffd7c7;
}
#gvPanel {
  margin-top: 35px;
  border-top: 2px dashed var(--accent);
  padding-top: 12px;
  text-align: left;
}
#gvPanel h3 {
  color: var(--accent);
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
}
th, td {
  border: 1px solid var(--border);
  padding: 6px;
  text-align: center;
}
th {
  background: #fff5ee;
}
#adminLogin {
  margin-top: 15px;
  text-align: center;
}
button {
  cursor: pointer;
}
#exportBtn, #clearBtn {
  background: #ff7a59;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 6px 10px;
  margin: 3px;
}
</style>
</head>
<body>
<div id="container">
  <h1>üéØ Tr√≤ ch∆°i luy·ªán g√µ 10 ng√≥n</h1>
  <div id="setup">
    <input id="nameInput" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" />
    <select id="lessonSelect">
      <option value="home">H√†ng ph√≠m c∆° b·∫£n</option>
      <option value="upper">H√†ng ph√≠m tr√™n</option>
      <option value="lower">H√†ng ph√≠m d∆∞·ªõi</option>
      <option value="number">S·ªë v√† k√Ω hi·ªáu</option>
    </select>
    <!-- üåü Th√™m ch·ªçn ch·∫ø ƒë·ªô ch∆°i -->
    <select id="modeSelect">
      <option value="practice">Luy·ªán t·∫≠p</option>
      <option value="challenge">Th·ª≠ th√°ch 30s</option>
    </select>
    <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
  </div>

  <div id="gameArea">
    <div id="timer"></div>
    <div id="targetText"></div>
    <div id="typedText"></div>
    <div id="result"></div>
  </div>

  <!-- üåà B√ÄN PH√çM -->
  <div id="keyboard">
    <div class="kb-row" id="row1"></div>
    <div class="kb-row" id="row2"></div>
    <div class="kb-row" id="row3"></div>
  </div>

  <!-- üìã B·∫¢NG GI√ÅO VI√äN -->
  <div id="gvPanel">
    <h3>üìã B·∫£ng theo d√µi gi√°o vi√™n</h3>
    <div id="adminLogin">
      <input type="password" id="gvPass" placeholder="M·∫≠t kh·∫©u gi√°o vi√™n" />
      <button id="gvLoginBtn">ƒêƒÉng nh·∫≠p</button>
    </div>
    <div id="adminTools" style="display:none;">
      <button id="exportBtn">‚¨áÔ∏è Xu·∫•t CSV</button>
      <button id="clearBtn">üóëÔ∏è X√≥a d·ªØ li·ªáu</button>
      <table id="scoreTable">
        <thead>
          <tr><th>T√™n</th><th>B√†i</th><th>ƒê·ªô ch√≠nh x√°c (%)</th><th>Th·ªùi gian (s)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
const lessons = {
  home: "asdf jkl; asdf jkl; aa ss dd ff jj kk ll ;; asdfjkl;",
  upper: "qwerty uiop qwe rty uio p qwert yuiop",
  lower: "zxcvbnm zxc bnm zx cv bn mz",
  number: "12345 67890 1 2 3 4 5 6 7 8 9 0"
};
const keyboardRows = [
  ["q","w","e","r","t","y","u","i","o","p"],
  ["a","s","d","f","g","h","j","k","l",";"],
  ["z","x","c","v","b","n","m",",",".","/"]
];
const nameInput = document.getElementById("nameInput");
const lessonSelect = document.getElementById("lessonSelect");
const modeSelect = document.getElementById("modeSelect");
const startBtn = document.getElementById("startBtn");
const targetText = document.getElementById("targetText");
const typedText = document.getElementById("typedText");
const result = document.getElementById("result");
const timer = document.getElementById("timer");
const gameArea = document.getElementById("gameArea");
const scoreTable = document.querySelector("#scoreTable tbody");
const gvPass = document.getElementById("gvPass");
const gvLoginBtn = document.getElementById("gvLoginBtn");
const adminTools = document.getElementById("adminTools");
const exportBtn = document.getElementById("exportBtn");
const clearBtn = document.getElementById("clearBtn");

function renderKeyboard(){
  document.getElementById("row1").innerHTML = keyboardRows[0].map(k=>`<span class="key" data-key="${k}">${k}</span>`).join('');
  document.getElementById("row2").innerHTML = keyboardRows[1].map(k=>`<span class="key" data-key="${k}">${k}</span>`).join('');
  document.getElementById("row3").innerHTML = keyboardRows[2].map(k=>`<span class="key" data-key="${k}">${k}</span>`).join('');
}
renderKeyboard();

let target = "", typed = "", startTime, timerId, timeLeft = 30, mode="practice";

startBtn.onclick = () => {
  const name = nameInput.value.trim();
  if (!name) { alert("H√£y nh·∫≠p t√™n!"); return; }
  target = lessons[lessonSelect.value];
  mode = modeSelect.value;
  typed = "";
  targetText.textContent = target;
  typedText.textContent = "";
  result.textContent = "";
  timer.textContent = "";
  gameArea.style.display = "block";
  nameInput.disabled = true;
  startBtn.disabled = true;
  startTime = Date.now();
  if (mode === "challenge") startChallengeTimer();
};

function startChallengeTimer(){
  timeLeft = 30;
  timer.textContent = "‚è±Ô∏è Th·ªùi gian: 30s";
  timerId = setInterval(()=>{
    timeLeft--;
    timer.textContent = `‚è±Ô∏è C√≤n ${timeLeft}s`;
    if (timeLeft <= 0){
      clearInterval(timerId);
      endChallenge();
    }
  },1000);
}

document.addEventListener("keydown", e => {
  if (!target) return;
  const key = e.key.toLowerCase();
  const keySpan = document.querySelector(`.key[data-key="${key}"]`);
  if (keySpan) {
    keySpan.classList.add("active");
    setTimeout(()=>keySpan.classList.remove("active"),120);
  }
  if (key.length === 1 || key === " ") {
    typed += key;
    typedText.textContent = typed;
    checkProgress();
  } else if (e.key === "Backspace") {
    typed = typed.slice(0,-1);
    typedText.textContent = typed;
  }
});

function checkProgress(){
  if (mode==="practice" && typed === target) {
    const elapsed = ((Date.now()-startTime)/1000).toFixed(1);
    const accuracy = Math.round(100*(1 - typoCount(typed, target)/target.length));
    result.textContent = `‚úÖ Ho√†n th√†nh! ${elapsed}s ‚Äî ƒê·ªô ch√≠nh x√°c: ${accuracy}%`;
    saveScore(nameInput.value, lessonSelect.value, accuracy, elapsed);
    resetGame();
  }
}
function endChallenge(){
  const correct = countCorrect(typed, target);
  result.textContent = `‚è∞ H·∫øt gi·ªù! G√µ ƒë√∫ng ${correct} k√Ω t·ª±.`;
  nameInput.disabled = false;
  startBtn.disabled = false;
  target = "";
}
function typoCount(a,b){
  let c=0;
  for(let i=0;i<b.length;i++) if(a[i]!==b[i]) c++;
  return c;
}
function countCorrect(a,b){
  let c=0;
  for(let i=0;i<a.length;i++) if(a[i]===b[i]) c++;
  return c;
}
function saveScore(name, lesson, accuracy, time){
  const data = JSON.parse(localStorage.getItem("typingScores")||"[]");
  data.push({name,lesson,accuracy,time});
  localStorage.setItem("typingScores",JSON.stringify(data));
  renderScores();
}
function renderScores(){
  const data = JSON.parse(localStorage.getItem("typingScores")||"[]");
  scoreTable.innerHTML = data.map(d=>`
    <tr>
      <td>${d.name}</td>
      <td>${lessonLabel(d.lesson)}</td>
      <td>${d.accuracy}</td>
      <td>${d.time}</td>
    </tr>`).join('');
}
function lessonLabel(code){
  return {
    home:"H√†ng c∆° b·∫£n",
    upper:"H√†ng tr√™n",
    lower:"H√†ng d∆∞·ªõi",
    number:"S·ªë & k√Ω hi·ªáu"
  }[code];
}
function resetGame(){
  clearInterval(timerId);
  nameInput.disabled = false;
  startBtn.disabled = false;
  target = "";
}

// Gi√°o vi√™n ƒëƒÉng nh·∫≠p
gvLoginBtn.onclick = () => {
  if (gvPass.value === "gvpass") {
    adminTools.style.display = "block";
    gvPass.disabled = true;
    gvLoginBtn.disabled = true;
    renderScores();
  } else {
    alert("Sai m·∫≠t kh·∫©u!");
  }
};
// Xu·∫•t CSV
exportBtn.onclick = () => {
  const data = JSON.parse(localStorage.getItem("typingScores")||"[]");
  if (data.length === 0) return alert("Kh√¥ng c√≥ d·ªØ li·ªáu!");
  const csv = "T√™n,B√†i,ƒê·ªô ch√≠nh x√°c,Th·ªùi gian\n" + data.map(d=>`${d.name},${lessonLabel(d.lesson)},${d.accuracy},${d.time}`).join("\n");
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "ket_qua_go10ngon.csv";
  a.click();
  URL.revokeObjectURL(url);
};
// X√≥a d·ªØ li·ªáu
clearBtn.onclick = () => {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu?")) {
    localStorage.removeItem("typingScores");
    renderScores();
  }
};
</script>
</body>
</html>
